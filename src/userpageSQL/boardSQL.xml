<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">

	<!-- 전체 게시물 카운트 -->
	<select id="getArticleCount" resultType="int">
		select count(*) from otoboard
	</select>

	<!-- 전체 게시물 조회 -->
	<select id="getArticles" resultType="otoDTO" parameterType="int">
		select
		num,writer,email,ph,subject,passwd,reg_date,ref,re_step,re_level,content,ip,readcount,r
		from (select
		num,writer,email,ph,subject,passwd,reg_date,ref,re_step,re_level,content,ip,readcount,rownum r
		from (select
		num,writer,email,ph,subject,passwd,reg_date,ref,re_step,re_level,content,ip,readcount
		from otoboard A,(select otonum from otoboard where writer=?) B where
		A.otonum = B.otonum) order by ref asc, re_level asc) order by ref asc,
		re_level asc ) 
					<![CDATA[where r >= #{statRow} and r <= #{endRow}]]>
	</select>

	<!-- 게시물 조회수 증가 -->
	<update id="updateNum" parameterType="int">
		update otoboard set readcount=readcount+1 where num = #{num}
	</update>

	<!-- 글번호 가져오기 -->
	<select id="getArticlesNum" resultType="otoDTO" parameterType="int">
		select * from otoboard where num=#{num}
	</select>

</mapper>